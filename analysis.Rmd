---
title: "Analysis of the global temperature development"
author: "Andreas Hofheinz"
date: "February 19, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

For this analysis we are using the Climate Change: Earth Surface Temperature Data from kaggle.
This data set can be found here: 
https://www.kaggle.com/berkeleyearth/climate-change-earth-surface-temperature-data#GlobalTemperatures.csv

### Load required packages
```{r, message=FALSE}
library(fxtract)
library(lubridate)
library(tidyverse)
```


### Read in data
```{r}
df_glob_temp = read.csv("GlobalTemperatures.csv")
# Use data from 1850 onwards
df_glob_temp$dt = as.Date(df_glob_temp$dt)
df_glob_temp = df_glob_temp[df_glob_temp$dt >= "1850-01-01",]
str(df_glob_temp)
```

For an annual view we would like to have the year in a separate column.
```{r}
df_glob_temp$year = year(df_glob_temp$dt)
```



### Create our user defined-functions
```{r, message=FALSE}
fun = function(data) {
  mean_sd = c(mean_temp = mean(data$LandAverageTemperature),
    sd_temp = sd(data$LandAverageTemperature))
  mean_sd
}
```


## fxtract

#### Setup
```{r, message=FALSE, results='hide'}
xtractor = Xtractor$new("xtractor")
xtractor$n_cores = 2
xtractor$add_data(df_glob_temp, group_by = "year")
xtractor$add_feature(fun)
```

#### Calculation
```{r, message=FALSE, results='hide'}
xtractor$calc_features()
```

#### Results
```{r}
xtractor$results
```


```{r}
df = xtractor$results
df$year = as.numeric(df$year)
g = ggplot(df, aes(x = year, y = mean_temp, group = 1)) + geom_point() + geom_smooth(method = "loess")
g = g + scale_x_continuous(breaks = seq(1850, 2015, by = 20)) + ggtitle("Development of average global temperature") + 
  labs(x = "Year", y = "Mean temperature [in Â°C]")
g + theme_bw()
```







